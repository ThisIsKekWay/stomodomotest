# Задание

- Проектирование БД
Задача: Спроектировать структуру БД для ситуации: Есть пациенты со своими атрибутами (ФИО, дата рождения, телефон, номер мед карты), сотрудники со своими (ФИО, дата рождения, телефон, ИНН). В каком количестве таблиц можно сохранить подобную структуру, если любой пациент может являться сотрудником и наоборот. Предложить несколько вариантов, сравнить их по критериям (плюсы и минусы):

    - удобство использования
    - расширяемость
    - целостность относительно других таблиц (например приемы, в примере ниже)
    - производительность
    - свои мысли


## Решение

### Вариант 1. Однотабличная структура

При решении в лоб можно сразу предложить однотабличную структуру для сущности, устанавливая ИНН и медкарту в NULL. Соответственно, если человек является и пациентом и работником, его поля ИНН и медкарты будут заполнены. Также в каждом варианте будет разделение поля ФИО на поля имени, фамилии и отчества для облегчения поиска пациентов или работников.

~~~
CREATE TABLE People (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    sur_name VARCHAR(255) NOT NULL,
    fathers_name VARCHAR(255) NOT NULL,
    birth_date DATE NOT NULL,
    phone VARCHAR(11),
    medical_card_number VARCHAR(50), -- NULL если человек не пациент
    inn VARCHAR(12) -- NULL если человек не сотрудник
);
~~~

- Плюсы и минусы
    - Удобство использования:
        - Плюс: Простая структура, все данные в одной таблице.
        - Минус: Возможны NULL значения для специфичных полей.
    - Расширяемость:
        - Плюс: Легко добавлять новые общие атрибуты.
        - Минус: Добавление новых специфичных атрибутов может усложнить структуру.
    - Целостность:
        - Плюс: Нет необходимости в сложных связях между таблицами.
        - Минус: Трудно поддерживать целостность специфичных данных.
    - Производительность:
        - Плюс: Быстрый доступ к данным.
        - Минус: Таблица может стать слишком большой.

Свои мысли: Однотабличный вариант вызовет большую транзакционную сложность выполнения запросов при высоком уровне изоляции или вызовет аномалии, наподобии "dirty read" при низком уровне. Для какого-никакого highload это является достаточным фактором для рассмотрения других вариантов. В эту же пользу свидетельствует факт, что таблица находится только в первой нормальной форме.

### Вариант 2. Люди, работники, пациенты.

Следующим вариантом можно рассмотреть разделение однотабличной структуры на три таблицы. Первая содержит данные о людях, вторая о работниках, третья о пациентах.

~~~
CREATE TABLE People (
    id SERIAL PRIMARY KEY,
    full_name VARCHAR(255) NOT NULL,
    birth_date DATE NOT NULL,
    phone VARCHAR(20)
);

CREATE TABLE Patients (
    patient_id INT PRIMARY KEY,
    medical_card_number VARCHAR(50) NOT NULL,
    FOREIGN KEY (person_id) REFERENCES People(id)
);

CREATE TABLE Employees (
    employee_id INT PRIMARY KEY,
    inn VARCHAR(12) NOT NULL,
    FOREIGN KEY (person_id) REFERENCES People(id)
);
~~~


- Плюсы и минусы
    - Удобство использования:
        - Плюс: Четкое разделение данных.
        - Минус: Необходимость объединения таблиц для получения полной информации.
    - Расширяемость:
        - Плюс: Легко добавлять новые специфичные атрибуты.
        - Минус: Усложняется структура при добавлении новых типов.
    - Целостность:
         - Плюс: Легче поддерживать целостность данных.
         - Минус: Необходимость в дополнительных проверках при изменении данных.
    - Производительность:
        - Плюс: Меньше данных в каждой таблице.
        - Минус: Более сложные запросы для получения полной информации.

Свои мысли: Приведенеи структуры БД в третью нормальную форму для каждой таблицы уже большой плюс. Сотрудники разных отделов могут отправлять запросы в части БД, которые находятся в их прямой зоне ответственности, что снизит и время ответа, и транзакционную сложность. В свою очередь, наблюдается дублирование данных, что повлияет на общий вес таблиц. Наблюдается позитивный тренд. Рассмотрим следующий вариант. 


### Вариант 3. Люди и роли.

Последним вариантом будет создание структуры из двух таблиц. Одна для людей, другая для ролей.

~~~
CREATE TABLE People (
    id SERIAL PRIMARY KEY,
    full_name VARCHAR(255) NOT NULL,
    birth_date DATE NOT NULL,
    phone VARCHAR(20)
);

CREATE TABLE Roles (
    person_id INT,
    role_type VARCHAR(20) NOT NULL, -- 'patient' или 'employee'
    medical_card_number VARCHAR(50), -- NULL если не пациент
    inn VARCHAR(12), -- NULL если не сотрудник
    PRIMARY KEY (person_id, role_type),
    FOREIGN KEY (person_id) REFERENCES People(id)
);
~~~

- Плюсы и минусы
    - Удобство использования:
        - Плюс: Гибкость в управлении ролями.
        - Минус: Необходимость валидации типа роли.
    - Расширяемость:
        - Плюс: Легко добавлять новые роли.
        - Минус: Усложняется логика управления ролями.
    - Целостность:
        - Плюс: Хорошая поддержка целостности через ограничения.
        - Минус: Требует дополнительных проверок.
    - Производительность:
        - Плюс: Оптимизировано для ролей.
        - Минус: Более сложные запросы для получения данных.

Свои мысли: Третья нормальная форма длля каждой таблицы, отсутсвие дублирования данных, однако придется обрабатывать запросы разного смысла. В зависимости от требований и инфраструктуры, придется сделать выбор между вторым и третьим вариантом.